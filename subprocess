subprocess  

subprocess 用于从 Python 启动和管理子进程（外部可执行程序）。
推荐使用列表形式的 args（例如 ['ffmpeg','-i','in.mp4']），避免 shell=True 带来的注入风险。
两种常见使用模式：同步（subprocess.run / check_output / call）和异步/流式（subprocess.Popen）。

何时用 Popen 而非 run：
需要与子进程实时交互（stdin/stdout）或流式处理大量输出时用 Popen。
简单的“调用并等待结果”用 run 足够且更简洁

subprocess.run 是同步运行外部命令的高层接口。它会等待命令执行完成，然后返回一个 CompletedProcess 实例（或抛出异常）。
推荐用列表形式传参（['ffmpeg','-i','in.mp4']）以避免 shell 注入风险；只有确实需要 shell 特性时才用 shell=True。
主要参数（常用）

args：命令及参数。列表（推荐）或字符串（当 shell=True 时常用）。
capture_output=True：同时捕获 stdout 和 stderr（等同于 stdout=PIPE, stderr=PIPE）。        **                        
stdout / stderr：可设为 subprocess.PIPE / subprocess.DEVNULL / 文件对象 等。                
check=True：当子进程返回非零退出码时抛出 subprocess.CalledProcessError。                    **
text=True：将 stdout/stderr 作为 str（文本）而非 bytes；等同于 universal_newlines=True。    **        
encoding / errors：指定解码编码与错误处理。   
cwd：在指定目录下执行命令。
env：指定子进程环境变量（字典）。
timeout：超时（秒），超时会抛出 subprocess.TimeoutExpired。
shell=True：通过 shell（如 cmd/powershell）执行命令（注意安全风险）。
返回值：subprocess.CompletedProcess                                                       **  

属性：
args: 传入的命令参数
returncode: 子进程退出码（0 通常表示成功）
stdout / stderr: 当 capture_output 或 stdout/stderr 指定时可用  

当 check=True 且返回码非 0，会抛出 subprocess.CalledProcessError，异常对象含 stdout/stderr（若被捕获）。  **

常见异常
FileNotFoundError：可执行文件不存在（例如 ffmpeg 不在 PATH）。    **
subprocess.CalledProcessError：check=True 且返回码非 0。        **      
subprocess.TimeoutExpired：到达 timeout。

安全注意
尽量使用列表形式 args。避免把用户输入直接拼接进 shell 命令并传给 shell=True。
shell=True 在处理复杂 shell 特性（管道、重定向）时方便，但要小心注入攻击。

示例：
    # python
    import subprocess

    cmd = ['ffmpeg', '-i', 'in.mp4', '-vf', 'fps=1', '-vsync', '0', 'out/frame_%04d.png']            
    try:
        proc = subprocess.run(cmd, capture_output=True, text=True, check=True)      
        print("成功，ffmpeg 输出（部分）:", proc.stderr.splitlines()[:5])            
    except FileNotFoundError:      
        print("可执行文件未找到：请安装 ffmpeg 并确保它在 PATH")
    except subprocess.CalledProcessError as e:
        print("命令失败，返回码：", e.returncode)
        print("stderr:", e.stderr)

